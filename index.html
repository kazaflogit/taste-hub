<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Taste Hub - ‰ªäÊôöÈ£ü‰πúÈ§∏Âä©Êâã</title>
    
    <!-- Mobile App Settings -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Taste Hub">
    <link rel="apple-touch-icon" href="https://img.icons8.com/fluency/96/shopping-basket.png">
    <link rel="icon" type="image/png" href="https://img.icons8.com/fluency/96/shopping-basket.png">

    <!-- React & Tailwind Libraries -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Firebase SDK (Optional) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+HK:wght@400;700;900&display=swap');
        body { font-family: 'Noto Sans HK', sans-serif; -webkit-tap-highlight-color: transparent; }
        .glass-nav { background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); }
        ::-webkit-scrollbar { width: 0px; background: transparent; }
        .hide-file-input { display: none; }
    </style>
</head>
<body class="bg-zinc-50 text-zinc-900">
    <div id="root"></div>

    <script type="text/babel">
        // --- Configuration ---
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {
            apiKey: "", 
            authDomain: "",
            projectId: "",
            storageBucket: "",
            messagingSenderId: "",
            appId: ""
        };
        
        let auth = null;
        let db = null;
        try {
            if (firebaseConfig.apiKey && !firebase.apps.length) {
                firebase.initializeApp(firebaseConfig);
                auth = firebase.auth();
                db = firebase.firestore();
            }
        } catch(e) { console.log("Running in Local Mode"); }
        
        const appId = 'family-dinner-planner'; 

        const { useState, useMemo, useEffect, useCallback, useRef } = React;

        // --- Built-in SVG Icons ---
        const Icons = {
            ChevronLeft: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m15 18-6-6 6-6"/></svg>,
            Search: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>,
            Plus: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12h14"/><path d="M12 5v14"/></svg>,
            Clock: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
            Shuffle: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 18h1.4c1.3 0 2.5-.6 3.3-1.7l14.2-12.6c.8-1.1 2-1.7 3.3-1.7H22"/><path d="M2 6h1.4c1.3 0 2.5.6 3.3 1.7l3.6 3.2"/><path d="M15.1 13.1l3.6 3.2c.8 1.1 2 1.7 3.3 1.7H22"/></svg>,
            ChevronRight: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m9 18 6-6-6-6"/></svg>,
            Pencil: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/><path d="m15 5 4 4"/></svg>,
            Check: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M20 6 9 17l-5-5"/></svg>,
            Trash2: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>,
            Share2: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" x2="15.42" y1="13.51" y2="17.49"/><line x1="15.41" x2="8.59" y1="6.51" y2="10.49"/></svg>,
            ShoppingBasket: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m5 11 4-7"/><path d="m19 11-4-7"/><path d="M2 11h20"/><path d="m3.5 11 1.6 7.4a2 2 0 0 0 2 1.6h9.8c.9 0 1.8-.7 2-1.6l1.7-7.4"/><path d="m9 11 1 9"/><path d="m15 11-1 9"/></svg>,
            Sparkles: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M9 3v4"/><path d="M3 5h4"/><path d="M3 9h4"/></svg>,
            Save: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>,
            CheckCircle2: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><path d="m9 12 2 2 4-4"/></svg>,
            Download: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>,
            Upload: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></svg>,
            Settings: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.35a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>,
            Cloud: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17.5 19c0-1.7-1.3-3-3-3h-1.1c-.2-1.7-1.7-3-3.4-3-1.9 0-3.5 1.6-3.5 3.5 0 .3 0 .5.1.8-2 .5-3.6 2.3-3.6 4.2 0 2.5 2 4.5 4.5 4.5h10c2.5 0 4.5-2 4.5-4.5s-2-4.5-4.5-4.5z"/></svg>,
            Sun: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>,
            Wind: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17.7 7.7a2.5 2.5 0 1 1 1.8 4.3H2"/><path d="M9.6 4.6A2 2 0 1 1 11 8H2"/><path d="M12.6 19.4A2 2 0 1 0 14 16H2"/></svg>,
            Snowflake: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="2" x2="22" y1="12" y2="12"/><line x1="12" x2="12" y1="2" y2="22"/><path d="m20 20-4-4"/><path d="m4 4 4 4"/><path d="m4 20 4-4"/><path d="m20 4-4 4"/></svg>
        };

        const Icon = ({ name, className, ...props }) => {
            const Component = Icons[name];
            if (!Component) return null;
            return <span className={className}><Component width="100%" height="100%" {...props} /></span>;
        };

        const DEFAULT_DISHES = [
            { id: 1, name: 'Ê≤ôËå∂ÈÜ¨ÁÇíÁâõËÇâ', category: 'ÁâõËÇâ', ingredients: ['ÁâõËÇâ', 'Ê≤ôËå∂ÈÜ¨', 'ÈùíÊ§í', 'ËíúÈ†≠'] },
            { id: 2, name: 'ËñØ‰ªîÁâõËÇâ', category: 'ÁâõËÇâ', ingredients: ['ÁâõËÇâ', 'ËñØ‰ªî', 'Ê¥ãËî•'] },
            { id: 3, name: 'ËïÉËåÑÁâõËÇâÁÇíËõã', category: 'ÁâõËÇâ', ingredients: ['ÁâõËÇâ', 'ËïÉËåÑ', 'ÈõûËõã'] },
            { id: 4, name: 'ÁâõËÇâÈ§Ö', category: 'ÁâõËÇâ', ingredients: ['ÁâõËÇâÁ¢é', 'È¶¨ËπÑ', 'Ëî•Ëä±'] },
            { id: 5, name: 'Ê¶®ËèúËí∏ÁâõËÇâ', category: 'ÁâõËÇâ', ingredients: ['ÁâõËÇâ', 'Ê¶®Ëèú', 'ËñëÁµ≤'] },
            { id: 6, name: 'ÈüìÂºèÁÇíÁ≤âÁµ≤', category: 'ÁâõËÇâ', ingredients: ['ÁâõËÇâ', 'ÈüìÂºèÂÜ¨Á≤â', 'Ê¥ãËî•', 'Á¥ÖËòøËîî'] },
            { id: 7, name: 'ËèúÂøÉÁÇíÁâõËÇâ', category: 'ÁâõËÇâ', ingredients: ['ÁâõËÇâ', 'ËèúÂøÉ', 'ËñëÁâá'] },
            { id: 8, name: 'ÈáëËèáËÇ•Áâõ', category: 'ÁâõËÇâ', ingredients: ['ËÇ•ÁâõÁâá', 'ÈáëËèá', 'Ê≤ôËå∂ÈÜ¨'] },
            { id: 9, name: 'È∫µË±âËí∏ÊéíÈ™®', category: 'Ë±¨ËÇâ', ingredients: ['ÊéíÈ™®', 'È∫µË±âÈÜ¨', 'ËíúÊú´'] },
            { id: 10, name: 'ÂÜ¨ÁìúÁÇÜË±¨ËÇâ', category: 'Ë±¨ËÇâ', ingredients: ['Ë±¨ËÇâ', 'ÂÜ¨Áìú', 'ËñëÁâá'] },
            { id: 11, name: 'ËÇâÁ¢éÁôΩËèúÁÖ≤', category: 'Ë±¨ËÇâ', ingredients: ['ËÇâÁ¢é', 'ÁôΩËèú‰ªî', 'Á≤âÁµ≤'] },
            { id: 12, name: 'È∫ªÂ©ÜË±ÜËÖê', category: 'Ë±¨ËÇâ', ingredients: ['ËÇâÁ¢é', 'ËªüË±ÜËÖê', 'Ëæ£Ë±ÜÁì£ÈÜ¨'] },
            { id: 13, name: 'ËåÑÂ≠êÁÖ≤', category: 'Ë±¨ËÇâ', ingredients: ['ËÇâÁ¢é', 'ËåÑÂ≠ê', 'ÈππÈ≠ö', 'Ë†îÊ≤π'] },
            { id: 14, name: 'Ê¥ãËî•Ë±¨Êâí', category: 'Ë±¨ËÇâ', ingredients: ['Ë±¨Êâí', 'Ê¥ãËî•', 'ËåÑÊ±Å'] },
            { id: 15, name: 'ÈππËõãËí∏ËÇâÈ§Ö', category: 'Ë±¨ËÇâ', ingredients: ['Ë±¨ËÇâÁ¢é', 'ÈππËõã'] },
            { id: 16, name: 'ÂúüÈ≠∑Ëí∏ËÇâÈ§Ö', category: 'Ë±¨ËÇâ', ingredients: ['Ë±¨ËÇâÁ¢é', 'ÂúüÈ≠∑', 'È¶¨ËπÑ'] },
            { id: 17, name: 'Ê¢ÖËèúËí∏Ë±¨ËÇâ', category: 'Ë±¨ËÇâ', ingredients: ['ÂçäËÇ•Áò¶Ë±¨ËÇâ', 'Ê¢ÖËèú'] },
            { id: 18, name: 'ËìÆËóïÈ§Ö', category: 'Ë±¨ËÇâ', ingredients: ['Ë±¨ËÇâÁ¢é', 'ËìÆËóï', 'Ëî•Ëä±'] },
            { id: 19, name: 'ÁîüÂßúÁáí', category: 'Ë±¨ËÇâ', ingredients: ['Ë±¨ËÇâÁâá', 'ËñëÊ≥•', 'Âë≥ÈÜÇ'] },
            { id: 20, name: 'ËûûËüª‰∏äÊ®π', category: 'Ë±¨ËÇâ', ingredients: ['ËÇâÁ¢é', 'Á≤âÁµ≤', 'Ëæ£Ë±ÜÁì£ÈÜ¨'] },
            { id: 21, name: 'ËÇâÁ¢éË±ÜËßí', category: 'Ë±¨ËÇâ', ingredients: ['ËÇâÁ¢é', 'Ë±ÜËßí', 'ËíúÈ†≠'] },
            { id: 22, name: 'Ëæ£ÁÇíË±¨ËÇâ', category: 'Ë±¨ËÇâ', ingredients: ['‰∫îËä±ËÇâÁâá', 'ÈüìÂºèËæ£ÈÜ¨', 'Ê¥ãËî•'] },
            { id: 23, name: 'ÈõûÁÖ≤', category: 'ÈõûËÇâ', ingredients: ['Èõû‰ª∂', 'Ê¥ãËî•', 'ËäπËèú', 'ÈõûÁÖ≤ÈÜ¨'] },
            { id: 24, name: 'ÂíñÂñ±ËñØ‰ªîÈõû', category: 'ÈõûËÇâ', ingredients: ['Èõû‰ª∂', 'ËñØ‰ªî', 'ÂíñÂñ±Á£ö'] },
            { id: 25, name: 'ÂÜ¨ËèáÁÇÜÈõû', category: 'ÈõûËÇâ', ingredients: ['Èõû‰ª∂', 'ÂÜ¨Ëèá', 'Ë†îÊ≤π'] },
            { id: 26, name: 'ÂçóÁìúÁÇíÈõû', category: 'ÈõûËÇâ', ingredients: ['Èõû‰ª∂', 'ÂçóÁìú', 'ËíúÈ†≠'] },
            { id: 27, name: 'Á¥ÖÊ£óÊû∏ÊùûËí∏Èõû', category: 'ÈõûËÇâ', ingredients: ['Èõû‰ª∂', 'Á¥ÖÊ£ó', 'Êû∏Êùû'] },
            { id: 28, name: 'Ê†óÂ≠êÁÇÜÈõû', category: 'ÈõûËÇâ', ingredients: ['Èõû‰ª∂', 'Ê†óÂ≠ê', 'Ë†îÊ≤π'] },
            { id: 29, name: 'ÁÖéÈõûÁøº', category: 'ÈõûËÇâ', ingredients: ['ÈõûÁøº', 'ÈπΩ', 'ÈªëËÉ°Ê§í'] },
            { id: 30, name: 'ÂãùÁìúÁÇíÈõû', category: 'ÈõûËÇâ', ingredients: ['ÈõûËÇâÁâá', 'ÂãùÁìú', 'Èõ≤ËÄ≥'] },
            { id: 31, name: 'Ë¶™Â≠ê‰∏º', category: 'ÈõûËÇâ', ingredients: ['ÈõûËÇâ', 'ÈõûËõã', 'Ê¥ãËî•', 'Êó•ÂºèÈ´òÊπØ'] },
            { id: 32, name: 'ÈªÉÈáëËù¶', category: 'Êµ∑ÈÆÆ', ingredients: ['Â§ßËù¶', 'ÈππËõãÈªÉ', 'ÁâõÊ≤π'] },
            { id: 33, name: 'Á≤üÁ±≥È≠öÂ°ä', category: 'Êµ∑ÈÆÆ', ingredients: ['È≠öÊü≥', 'Á≤üÁ±≥Ëìâ', 'ÈõûËõã'] },
            { id: 34, name: 'ÁÖé‰∏âÊñáÈ≠ö', category: 'Êµ∑ÈÆÆ', ingredients: ['‰∏âÊñáÈ≠öÊü≥', 'Ê™∏Ê™¨', 'ÈªëËÉ°Ê§í', 'È¶ôËçâ'] },
            { id: 35, name: 'È∫µË±âËí∏È≠ö', category: 'Êµ∑ÈÆÆ', ingredients: ['ÂÖ®È≠ö', 'È∫µË±âÈÜ¨', 'ËñëÁµ≤'] },
            { id: 36, name: 'ÁÇíËúÜ', category: 'Êµ∑ÈÆÆ', ingredients: ['ËúÜ', 'Ë±ÜË±âËæ£Ê§íÈÜ¨', '‰πùÂ±§Â°î'] },
            { id: 37, name: 'Ëí∏ÊâáË≤ù', category: 'Êµ∑ÈÆÆ', ingredients: ['ÊâáË≤ù', 'Á≤âÁµ≤', 'ËíúËìâ'] },
            { id: 38, name: 'ËäùÂ£´Áï™ËåÑÁÇíËòëËèá', category: 'Ëî¨Ëèú', ingredients: ['ËòëËèá', 'Áï™ËåÑ', 'ËäùÂ£´Á¢é'] },
            { id: 39, name: 'ÁÇíÂπ¥Á≥ï', category: 'Ëî¨Ëèú', ingredients: ['Âπ¥Á≥ï', 'Ê§∞Ëèú', 'Ê¥ãËî•', 'ÈüìÂºèËæ£ÈÜ¨'] },
            { id: 40, name: 'ÁÇíÈΩã', category: 'Ëî¨Ëèú', ingredients: ['Èõ≤ËÄ≥', 'Èõ™ËÄ≥', 'Á¥ÖËòøËîî', 'ËÖêÁ´π'] },
            { id: 41, name: 'ËïÉËåÑÁÇíËõã', category: 'Ëî¨Ëèú', ingredients: ['ËïÉËåÑ', 'ÈõûËõã', 'Ëî•'] },
            { id: 42, name: '‰πæÁÖ∏ÂõõÂ≠£Ë±Ü', category: 'Ëî¨Ëèú', ingredients: ['ÂõõÂ≠£Ë±Ü', 'ËÇâÁ¢é', 'Ëù¶Á±≥'] },
            { id: 43, name: 'Ëä´ËçΩÈ≠öÁâáÊπØ', category: 'ÊπØÁæπ', ingredients: ['È≠öÁâá', 'Ëä´ËçΩ', 'ÁöÆËõã', 'Ë±ÜËÖê'] },
            { id: 44, name: 'ËïÉËåÑÊ¥ãËî•ÊπØ', category: 'ÊπØÁæπ', ingredients: ['ËïÉËåÑ', 'Ê¥ãËî•', 'ËñØ‰ªî', 'Áò¶ËÇâ'] },
            { id: 45, name: 'ÂÜ¨ÁìúÈππËõãÊπØ', category: 'ÊπØÁæπ', ingredients: ['ÂÜ¨Áìú', 'ÈππËõã', 'ËÇâÁ¢é'] },
            { id: 46, name: 'Ê≥°ËèúË±¨ËÇâÊπØ', category: 'ÊπØÁæπ', ingredients: ['Ê≥°Ëèú', 'Ë±¨‰∫îËä±', 'Ë±ÜËÖê'] },
            { id: 47, name: 'ËÉ°Ê§íË±¨ËÇöÊπØ', category: 'ÊπØÁæπ', ingredients: ['Ë±¨ËÇö', 'ÁôΩËÉ°Ê§í', 'ÈππËèú'] },
            { id: 48, name: 'ÂÜ¨ÁìúÊπØ', category: 'ÊπØÁæπ', ingredients: ['ÂÜ¨Áìú', 'ËñèÁ±≥', 'Áò¶ËÇâ'] },
            { id: 49, name: 'È≠öÈ†≠Ë±ÜËÖêÊπØ', category: 'ÊπØÁæπ', ingredients: ['È≠öÈ†≠', 'Ë±ÜËÖê', 'Ëñë'] },
            { id: 50, name: 'Á∂†Ë±ÜÊ≤ô', category: 'ÁîúÂìÅ', ingredients: ['Á∂†Ë±Ü', 'Èô≥ÁöÆ', 'ÂÜ∞Á≥ñ'] },
            { id: 51, name: 'ËìÆÂ≠êÈõ™ËÄ≥Á¥ÖÊ£óÊπØ', category: 'ÁîúÂìÅ', ingredients: ['ËìÆÂ≠ê', 'Èõ™ËÄ≥', 'Á¥ÖÊ£ó', 'ÂÜ∞Á≥ñ'] },
            { id: 52, name: 'ÁÇíÁÉèÂÜ¨', category: 'ÁÇíÁ≤âÈ∫µÈ£Ø', ingredients: ['ÁÉèÂÜ¨', 'ËÇâÁµ≤', 'Ê§∞Ëèú'] },
            { id: 53, name: 'Èõ™ËèúËÇâÁµ≤Á±≥', category: 'ÁÇíÁ≤âÈ∫µÈ£Ø', ingredients: ['Á±≥Á≤â', 'Èõ™Ëèú', 'ËÇâÁµ≤'] },
            { id: 54, name: 'ÂêâÈáéÂÆ∂ÁâõËÇâÈ£Ø', category: 'ÁÇíÁ≤âÈ∫µÈ£Ø', ingredients: ['ËÇ•ÁâõÁâá', 'Ê¥ãËî•', 'Êó•ÂºèÈÜ¨Ê±Å'] },
            { id: 55, name: 'Ëù¶Á≤•', category: 'ÁÇíÁ≤âÈ∫µÈ£Ø', ingredients: ['ÁôΩÁ±≥', 'Ëù¶', 'ËñëÁµ≤'] },
            { id: 56, name: 'ÁÇíÈ£Ø', category: 'ÁÇíÁ≤âÈ∫µÈ£Ø', ingredients: ['ÁôΩÈ£Ø', 'ÈõûËõã', 'ÁÅ´ËÖø'] },
            { id: 57, name: 'ÁâõËÇâ (ÁÅ´Èçã)', category: 'ÊâìÈÇäÁàê', ingredients: ['ËÇ•ÁâõÁâá', 'ÊâãÂàáÁâõ'] },
            { id: 58, name: 'Â¢®‰∏∏', category: 'ÊâìÈÇäÁàê', ingredients: ['Â¢®È≠ö‰∏∏'] },
            { id: 59, name: 'È≠öËõã', category: 'ÊâìÈÇäÁàê', ingredients: ['È≠öËõã'] },
            { id: 60, name: 'È≠öËßí', category: 'ÊâìÈÇäÁàê', ingredients: ['È≠öËßí'] },
            { id: 61, name: 'ÁÇ∏È≠öÁöÆ', category: 'ÊâìÈÇäÁàê', ingredients: ['ÁÇ∏È≠öÁöÆ'] },
            { id: 62, name: 'ÈõûËÇâ (ÁÅ´Èçã)', category: 'ÊâìÈÇäÁàê', ingredients: ['Èõû‰ª∂/ÈõûËÇâÁâá'] },
            { id: 63, name: 'Ë±¨ËÇâÁâá (ÁÅ´Èçã)', category: 'ÊâìÈÇäÁàê', ingredients: ['Ë±¨ËÇâÁâá'] },
            { id: 64, name: 'Ëèú (ÁÅ´Èçã)', category: 'ÊâìÈÇäÁàê', ingredients: ['ÁîüËèú', 'Ê≤πÈ∫•Ëèú', 'Â®ÉÂ®ÉËèú'] },
            { id: 65, name: 'Ëä´ËåúÈ§É', category: 'ÊâìÈÇäÁàê', ingredients: ['Ëä´ËåúÈ§É'] },
            { id: 66, name: 'È§É', category: 'ÊâìÈÇäÁàê', ingredients: ['Ê∞¥È§É'] },
            { id: 67, name: 'ÈüøÈà¥', category: 'ÊâìÈÇäÁàê', ingredients: ['ÈüøÈà¥'] },
            { id: 68, name: 'ÂùêÂ¢ä', category: 'ÊâìÈÇäÁàê', ingredients: ['È≠öËÇâÂùêÂ¢ä'] },
            { id: 69, name: 'ÁÉèÂÜ¨ (ÁÅ´Èçã)', category: 'ÊâìÈÇäÁàê', ingredients: ['ÁÉèÂÜ¨'] },
            { id: 70, name: 'Ëô´ËçâËä±', category: 'ÊâìÈÇäÁàê', ingredients: ['Ëô´ËçâËä±'] },
        ];

        const CATEGORIES = [
            { name: 'ÁâõËÇâ', icon: 'üêÆ', color: 'from-rose-400 to-rose-600', bg: 'bg-rose-50', type: 'meat' },
            { name: 'Ë±¨ËÇâ', icon: 'üê∑', color: 'from-pink-400 to-pink-600', bg: 'bg-pink-50', type: 'meat' },
            { name: 'ÈõûËÇâ', icon: 'üêî', color: 'from-orange-400 to-orange-600', bg: 'bg-orange-50', type: 'meat' },
            { name: 'Êµ∑ÈÆÆ', icon: 'üêü', color: 'from-blue-400 to-blue-600', bg: 'bg-blue-50', type: 'meat' },
            { name: 'ÊâìÈÇäÁàê', icon: 'ü•ò', color: 'from-emerald-400 to-emerald-600', bg: 'bg-emerald-50', type: 'other' },
            { name: 'Ëî¨Ëèú', icon: 'ü•¶', color: 'from-green-400 to-green-600', bg: 'bg-green-50', type: 'veg' },
            { name: 'ÊπØÁæπ', icon: 'üç≤', color: 'from-amber-400 to-amber-600', bg: 'bg-amber-50', type: 'soup' },
            { name: 'ÁîúÂìÅ', icon: 'üç°', color: 'from-purple-400 to-purple-600', bg: 'bg-purple-50', type: 'other' },
            { name: 'ÁÇíÁ≤âÈ∫µÈ£Ø', icon: 'üçù', color: 'from-yellow-400 to-yellow-600', bg: 'bg-yellow-50', type: 'other' },
        ];

        function App() {
            const [user, setUser] = useState(null);
            
            // --- DATA INITIALIZATION & PERSISTENCE ---
            const [dishes, setDishes] = useState(() => {
                const saved = localStorage.getItem('tasteHub_dishes');
                if (saved) {
                    try {
                        return JSON.parse(saved);
                    } catch(e) { return DEFAULT_DISHES; }
                }
                return DEFAULT_DISHES;
            });

            const [selectedIds, setSelectedIds] = useState([]);
            const [view, setView] = useState('categories'); // views: categories, category_detail, meal, add, edit, search, share
            const [activeCategory, setActiveCategory] = useState(null);
            const [searchTerm, setSearchTerm] = useState('');
            const [purchasedIngredients, setPurchasedIngredients] = useState(new Set());
            const [formData, setFormData] = useState({ id: null, name: '', category: 'Ëî¨Ëèú', ingredients: '' });
            
            // State for Export Selection
            const [exportSelection, setExportSelection] = useState(new Set());

            // 1. Auth (Optional)
            useEffect(() => {
                if (auth) {
                    const initAuth = async () => {
                        try { await auth.signInAnonymously(); } catch (e) {}
                    };
                    initAuth();
                    return auth.onAuthStateChanged(setUser);
                }
            }, []);

            // 2. Persistence Helper
            const updateDishes = (newDishes) => {
                setDishes(newDishes);
                localStorage.setItem('tasteHub_dishes', JSON.stringify(newDishes));
            };

            const seasonalTip = useMemo(() => {
                const month = new Date().getMonth() + 1;
                if (month >= 3 && month <= 5) return { text: "Êò•Â§©ÊΩÆÊøïÔºåÂª∫Ë≠∞Â§öÂä†‰∫õËä´ËçΩ„ÄÅÁîüËñëÂéªÊøïÊ∞£„ÄÇ", icon: 'Cloud' };
                if (month >= 6 && month <= 8) return { text: "Â§èÂ§©ÁÇéÁÜ±ÔºåÈÅ©ÂêàÊ∏ÖÁÜ±Ê∂àÊöëÁöÑÂÜ¨ÁìúÊπØ„ÄÇ", icon: 'Sun' };
                if (month >= 9 && month <= 11) return { text: "ÁßãÂ§©‰πæÁá•ÔºåË®òÂæóÂ§öÂêÉÈªûËìÆËóïÊΩ§Áá•„ÄÇ", icon: 'Wind' };
                return { text: "ÂÜ¨Â§©ÂØíÂÜ∑Ôºå‰æÜÈªûÈªëÊ§í„ÄÅÈ∫ªËæ£ÊöñËÉÉÂêß„ÄÇ", icon: 'Snowflake' };
            }, []);

            const aggregatedIngredients = useMemo(() => {
                const map = new Map();
                dishes.filter(d => selectedIds.includes(d.id)).forEach(dish => {
                    dish.ingredients.forEach(ing => {
                        const name = ing.trim();
                        if (!name) return;
                        map.set(name, (map.get(name) || 0) + 1);
                    });
                });
                return Array.from(map.entries()).map(([name, count]) => ({ name, count }));
            }, [dishes, selectedIds]);

            // --- Handlers ---
            const startEditing = (dish) => {
                setFormData({
                    id: dish.id,
                    name: dish.name,
                    category: dish.category,
                    ingredients: dish.ingredients.join(', ')
                });
                setView('edit');
            };

            const deleteDish = (id) => {
                if(confirm('Á¢∫ÂÆöË¶ÅÊ∞∏‰πÖÂà™Èô§ÂóéÔºü')) {
                    const newDishes = dishes.filter(d => d.id !== id);
                    updateDishes(newDishes);
                    setSelectedIds(prev => prev.filter(i => i !== id));
                    setView('category_detail'); 
                }
            };

            const handleRandomize = () => {
                const getBy = (t) => dishes.filter(d => CATEGORIES.find(c => c.name === d.category)?.type === t);
                const picks = [getBy('meat'), getBy('veg'), getBy('soup')].map(list => list.length ? list[Math.floor(Math.random() * list.length)].id : null).filter(Boolean);
                setSelectedIds(picks);
                setView('meal');
            };

            const shareWA = () => {
                const names = dishes.filter(d => selectedIds.includes(d.id)).map(d => `üç± ${d.name}`).join('\n');
                const ings = aggregatedIngredients.map(i => `- ${i.name}${i.count > 1 ? ` (x${i.count})` : ''}`).join('\n');
                const text = `üõí *‰ªäÊôöÈ£ü‰πúÈ§∏Ë≤∑È§∏Ê∏ÖÂñÆ*\n\n*ËèúÂºèÔºö*\n${names}\n\n*È£üÊùêÔºö*\n${ings}`;
                window.open(`https://wa.me/?text=${encodeURIComponent(text)}`, '_blank');
            };

            const saveDish = (e) => {
                e.preventDefault();
                const id = formData.id || Date.now();
                const ingredientsArray = formData.ingredients.split(/[,Ôºå\s]+/).filter(Boolean);
                const dish = { id, name: formData.name, category: formData.category, ingredients: ingredientsArray };
                
                // Check if update or new
                const exists = dishes.find(d => d.id === id);
                let newDishes;
                if (exists) {
                    newDishes = dishes.map(d => d.id === id ? dish : d);
                } else {
                    newDishes = [dish, ...dishes];
                }
                
                updateDishes(newDishes);
                setView('categories');
            };

            const removeDishSelection = (id) => {
                setSelectedIds(prev => prev.filter(i => i !== id));
                setPurchasedIngredients(prev => {
                    const next = new Set(prev);
                    Array.from(next).forEach(key => { if (key.startsWith(`${id}-`)) next.delete(key); });
                    return next;
                });
            };

            const toggleSelect = (id) => {
                setSelectedIds(prev => prev.includes(id) ? prev.filter(i => i !== id) : [...prev, id]);
            };

            const toggleIngredient = (dishId, ingName) => {
                const key = `${dishId}-${ingName}`;
                setPurchasedIngredients(prev => {
                    const next = new Set(prev);
                    if (next.has(key)) next.delete(key); else next.add(key);
                    return next;
                });
            };

            // --- Import / Export Handlers ---
            const fileInputRef = useRef(null);

            const handleExport = () => {
                const toExport = dishes.filter(d => exportSelection.has(d.id));
                if (toExport.length === 0) return alert("Please select at least one dish to export.");
                
                const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(toExport));
                const downloadAnchorNode = document.createElement('a');
                downloadAnchorNode.setAttribute("href", dataStr);
                downloadAnchorNode.setAttribute("download", "taste_hub_recipes.json");
                document.body.appendChild(downloadAnchorNode);
                downloadAnchorNode.click();
                downloadAnchorNode.remove();
            };

            const handleImportClick = () => {
                fileInputRef.current.click();
            };

            const handleFileChange = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const imported = JSON.parse(event.target.result);
                        if (Array.isArray(imported)) {
                            const existingNames = new Set(dishes.map(d => d.name));
                            // Filter duplicates and assign new IDs to avoid conflicts
                            const newDishes = imported.filter(d => !existingNames.has(d.name)).map(d => ({...d, id: Date.now() + Math.random()}));
                            
                            if (newDishes.length === 0) {
                                alert("No new dishes found (duplicates skipped).");
                            } else {
                                const combined = [...dishes, ...newDishes];
                                updateDishes(combined);
                                alert(`Successfully imported ${newDishes.length} new dishes!`);
                            }
                        } else {
                            alert("Invalid file format.");
                        }
                    } catch (err) { alert('Error reading file.'); }
                };
                reader.readAsText(file);
                e.target.value = null; // Reset input
            };

            const toggleExportSelection = (id) => {
                setExportSelection(prev => {
                    const next = new Set(prev);
                    if (next.has(id)) next.delete(id);
                    else next.add(id);
                    return next;
                });
            };

            const selectAllExport = () => {
                if (exportSelection.size === dishes.length) {
                    setExportSelection(new Set());
                } else {
                    setExportSelection(new Set(dishes.map(d => d.id)));
                }
            };

            const greeting = new Date().getHours() < 12 ? "‰ªäÊúùÈ£ü‰πúÂ•ΩÔºü" : "‰ªäÊôöÁÖÆ‰πúÈ§∏Ôºü";

            // Filters
            const currentCategoryDishes = useMemo(() => dishes.filter(d => d.category === activeCategory), [dishes, activeCategory]);
            const searchResults = useMemo(() => searchTerm ? dishes.filter(d => d.name.includes(searchTerm)) : [], [dishes, searchTerm]);
            const selectedDishes = useMemo(() => dishes.filter(d => selectedIds.includes(d.id)), [dishes, selectedIds]);

            return (
                <div className="min-h-screen pb-32">
                    {/* Header */}
                    <nav className="sticky top-0 z-50 glass-nav border-b border-zinc-200/50 px-6 py-5 flex items-center justify-between">
                        <div className="flex items-center gap-4">
                            {view !== 'categories' && <button onClick={() => setView('categories')} className="text-zinc-400 active:scale-90 transition-transform"><Icon name="ChevronLeft" className="w-6 h-6 text-zinc-600" /></button>}
                            <div>
                                <h1 className="text-xl font-black tracking-tight">TASTE HUB</h1>
                                <p className="text-[10px] font-bold text-zinc-400 uppercase tracking-widest">Dishes Planner</p>
                            </div>
                        </div>
                        <div className="flex gap-2">
                            <button onClick={() => setView('search')} className="p-2.5 rounded-2xl bg-white border border-zinc-200 shadow-sm active:scale-90 transition-transform"><Icon name="Search" className="w-5 h-5 text-zinc-600" /></button>
                            <button onClick={() => {setFormData({id: null, name: '', category: 'Ëî¨Ëèú', ingredients: ''}); setView('add');}} className="p-2.5 rounded-2xl bg-zinc-900 text-white shadow-lg active:scale-90 transition-transform"><Icon name="Plus" className="w-5 h-5" /></button>
                        </div>
                    </nav>

                    <main className="max-w-md mx-auto px-6 pt-8">
                        {/* 1. Dashboard */}
                        {view === 'categories' && (
                            <div className="animate-in fade-in duration-300">
                                <header className="mb-8">
                                    <div className="flex items-center gap-2 mb-2 text-orange-500"><Icon name="Clock" className="w-4 h-4" /><span className="text-xs font-bold uppercase tracking-widest">Dishes Planner</span></div>
                                    <h2 className="text-4xl font-black text-zinc-900">{greeting}</h2>
                                    <div className="mt-4 bg-orange-50 p-4 rounded-3xl flex items-start gap-3 border border-orange-100">
                                        <div className="text-orange-500 mt-1"><Icon name="Plus" className="w-4 h-4" /></div>
                                        <p className="text-xs font-bold text-orange-800/80 leading-relaxed">{seasonalTip.text}</p>
                                    </div>
                                </header>
                                
                                {/* Tools Section */}
                                <div className="mb-6 flex gap-3">
                                    <button onClick={handleRandomize} className="flex-1 bg-gradient-to-r from-zinc-900 to-zinc-800 p-4 rounded-[1.5rem] text-white flex items-center justify-between shadow-xl active:scale-95 transition-all">
                                        <div className="flex items-center gap-2"><Icon name="Shuffle" className="w-5 h-5 text-orange-500" /><span className="font-bold text-sm">Èö®Ê©üÊäΩÁ±§</span></div>
                                    </button>
                                    <button onClick={() => { setExportSelection(new Set(dishes.map(d=>d.id))); setView('share'); }} className="bg-white border border-zinc-200 p-4 rounded-[1.5rem] text-zinc-600 flex items-center justify-center shadow-sm active:scale-95 transition-all">
                                        <Icon name="Settings" className="w-5 h-5" />
                                    </button>
                                </div>

                                <div className="grid grid-cols-3 gap-4">
                                    {CATEGORIES.map(cat => (
                                        <button key={cat.name} onClick={() => { setActiveCategory(cat.name); setView('category_detail'); }} className={`relative flex flex-col items-center justify-center aspect-square rounded-[2rem] ${cat.bg} active:scale-90 transition-all border-2 border-transparent hover:border-zinc-200`}>
                                            <span className="text-4xl mb-2">{cat.icon}</span>
                                            <span className="font-bold text-xs text-zinc-800">{cat.name}</span>
                                        </button>
                                    ))}
                                </div>
                            </div>
                        )}

                        {/* 2. Category Detail */}
                        {view === 'category_detail' && (
                            <div className="animate-in slide-in-from-right-8 duration-300">
                                <h2 className="text-4xl font-black mb-6 flex items-center gap-2">
                                    <span>{CATEGORIES.find(c => c.name === activeCategory)?.icon}</span>
                                    {activeCategory}
                                </h2>
                                <div className="grid gap-4">
                                    {currentCategoryDishes.map(dish => (
                                        <div key={dish.id} className={`flex items-center rounded-3xl border-2 p-1 transition-all ${selectedIds.includes(dish.id) ? 'bg-zinc-900 border-zinc-900 text-white shadow-xl' : 'bg-white border-zinc-100 shadow-sm'}`}>
                                            <button onClick={() => startEditing(dish)} className="p-5 text-zinc-400 hover:text-orange-500"><Icon name="Pencil" className="w-5 h-5" /></button>
                                            <div onClick={() => toggleSelect(dish.id)} className="flex-grow py-5 pr-6 flex items-center justify-between cursor-pointer">
                                                <span className="font-bold text-lg">{dish.name}</span>
                                                <div className={`w-6 h-6 rounded-full border-2 flex items-center justify-center ${selectedIds.includes(dish.id) ? 'bg-orange-500 border-orange-500' : 'border-zinc-200'}`}>
                                                    {selectedIds.includes(dish.id) && <Icon name="Check" className="w-4 h-4 text-white" />}
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {/* 3. Meal List */}
                        {view === 'meal' && (
                            <div className="animate-in slide-in-from-bottom-8 duration-500 space-y-8">
                                <div className="bg-zinc-900 rounded-[2.5rem] p-10 text-white shadow-2xl relative overflow-hidden">
                                    <h2 className="text-4xl font-black mb-4">Ê∫ñÂÇôÈñãÈ£ØÔºÅ</h2>
                                    <button onClick={shareWA} className="bg-white/10 px-4 py-2 rounded-xl text-xs font-bold flex items-center gap-2"><Icon name="Share2" className="w-3 h-3" /> ÂàÜ‰∫´Âà∞ WhatsApp</button>
                                    <Icon name="ShoppingBasket" className="absolute -bottom-4 -right-4 w-32 h-32 opacity-10 -rotate-12" />
                                </div>
                                <section className="bg-zinc-100 p-6 rounded-[2rem] border-2 border-dashed border-zinc-200">
                                    <h3 className="text-xs font-black text-zinc-400 uppercase tracking-widest mb-4 flex items-center gap-2"><Icon name="Sparkles" className="w-3 h-3 text-orange-500" /> Aggregated Ingredients</h3>
                                    <div className="flex flex-wrap gap-2">
                                        {aggregatedIngredients.map((item, idx) => (
                                            <div key={idx} className="bg-white border px-4 py-2 rounded-2xl text-sm font-bold shadow-sm">{item.name} <span className="text-orange-500 ml-1">x{item.count}</span></div>
                                        ))}
                                    </div>
                                </section>
                                {selectedDishes.map(dish => (
                                    <div key={dish.id} className="bg-white rounded-3xl p-8 shadow-xl border border-zinc-100">
                                        <div className="flex justify-between items-center mb-6 pb-4 border-b border-zinc-50">
                                            <h3 className="text-2xl font-black">{dish.name}</h3>
                                            <button onClick={() => removeDishSelection(dish.id)} className="text-zinc-300 hover:text-rose-500"><Icon name="Trash2" className="w-6 h-6" /></button>
                                        </div>
                                        <div className="space-y-3">
                                            {dish.ingredients.map((ing, i) => {
                                                const isPurchased = purchasedIngredients.has(`${dish.id}-${ing}`);
                                                return (
                                                    <div key={i} onClick={() => toggleIngredient(dish.id, ing)} className={`flex items-center gap-4 px-5 py-4 rounded-2xl border-2 bg-white border-zinc-100 shadow-sm cursor-pointer transition-all ${isPurchased ? 'opacity-50' : ''}`}>
                                                        <div className={`w-6 h-6 rounded-xl border-2 flex items-center justify-center ${isPurchased ? 'bg-zinc-900 border-zinc-900' : 'border-zinc-200'}`}>
                                                            {isPurchased && <Icon name="Check" className="w-4 h-4 text-white" />}
                                                        </div>
                                                        <span className={`font-bold text-zinc-700 ${isPurchased ? 'line-through' : ''}`}>{ing}</span>
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}

                        {/* 4. Add/Edit Form */}
                        {(view === 'add' || view === 'edit') && (
                            <form onSubmit={saveDish} className="space-y-6 animate-in fade-in duration-300">
                                <h2 className="text-4xl font-black">{view === 'add' ? 'New' : 'Edit'} Dish</h2>
                                <input required type="text" className="w-full px-6 py-5 rounded-3xl border-2 border-zinc-100 focus:border-orange-400 outline-none text-xl font-bold" placeholder="ËèúÂêç..." value={formData.name} onChange={e => setFormData({...formData, name: e.target.value})} />
                                <div className="grid grid-cols-3 gap-2">
                                    {CATEGORIES.map(c => (
                                        <button key={c.name} type="button" onClick={() => setFormData({...formData, category: c.name})} className={`py-4 rounded-2xl text-[10px] font-black border-2 flex flex-col items-center justify-center gap-1 ${formData.category === c.name ? 'bg-zinc-900 text-white border-zinc-900' : 'bg-white text-zinc-400 border-zinc-100'}`}>
                                            <span className="text-xl">{c.icon}</span>
                                            {c.name}
                                        </button>
                                    ))}
                                </div>
                                <textarea rows="4" className="w-full px-6 py-5 rounded-3xl border-2 border-zinc-100 focus:border-orange-400 outline-none font-bold" placeholder="È£üÊùê (Áî®ÈÄóËôüÈöîÈñã)..." value={formData.ingredients} onChange={e => setFormData({...formData, ingredients: e.target.value})} />
                                <button type="submit" className="w-full bg-zinc-900 text-white py-6 rounded-3xl font-black text-xl hover:bg-orange-600 shadow-2xl flex items-center justify-center gap-3"><Icon name="Save" className="w-6 h-6" /> ÂÑ≤Â≠òÈ£üË≠ú</button>
                                {view === 'edit' && <button type="button" onClick={() => deleteDish(formData.id)} className="w-full py-5 rounded-3xl font-bold text-rose-500 bg-rose-50 border-2 border-rose-100">Ê∞∏‰πÖÂà™Èô§</button>}
                            </form>
                        )}
                        
                        {/* 5. Search */}
                        {view === 'search' && (
                            <div className="animate-in fade-in duration-300">
                                <h2 className="text-4xl font-black mb-6">Search</h2>
                                <input autoFocus type="text" className="w-full px-6 py-5 rounded-3xl border-2 border-zinc-100 outline-none text-xl font-bold mb-4" placeholder="ÊêúÂ∞ãËèúÂêç..." value={searchTerm} onChange={e => setSearchTerm(e.target.value)} />
                                <div className="grid gap-4">
                                    {dishes.filter(d => d.name.includes(searchTerm)).map(dish => (
                                        <div key={dish.id} onClick={() => toggleSelect(dish.id)} className={`p-6 rounded-3xl border-2 flex items-center justify-between cursor-pointer ${selectedIds.includes(dish.id) ? 'bg-zinc-900 text-white border-zinc-900' : 'bg-white border-zinc-100'}`}>
                                            <div><span className="text-[10px] font-black opacity-50 block mb-1 uppercase tracking-widest">{dish.category}</span><span className="text-xl font-bold">{dish.name}</span></div>
                                            {selectedIds.includes(dish.id) && <Icon name="CheckCircle2" className="w-6 h-6 text-orange-500" />}
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {/* 6. Share / Backup */}
                        {view === 'share' && (
                            <div className="animate-in fade-in duration-300 space-y-8">
                                <header>
                                    <div className="flex items-center gap-2 mb-2 text-orange-500"><Icon name="Settings" className="w-4 h-4" /><span className="text-xs font-bold uppercase tracking-widest">Data Center</span></div>
                                    <h2 className="text-4xl font-black text-zinc-900">Backup & Share</h2>
                                </header>

                                {/* Export Section */}
                                <section className="bg-white p-6 rounded-[2rem] border border-zinc-200 shadow-sm">
                                    <h3 className="font-black text-xl mb-2 flex items-center gap-2"><Icon name="Download" className="w-5 h-5 text-blue-500" /> Export Dishes</h3>
                                    <p className="text-sm text-zinc-500 mb-4">Select dishes to share with friends or backup.</p>
                                    
                                    <div className="flex justify-between items-center mb-4">
                                        <button onClick={selectAllExport} className="text-xs font-bold text-orange-500 bg-orange-50 px-3 py-1 rounded-full">
                                            {exportSelection.size === dishes.length ? 'Deselect All' : 'Select All'}
                                        </button>
                                        <span className="text-xs font-bold text-zinc-400">{exportSelection.size} Selected</span>
                                    </div>

                                    <div className="h-64 overflow-y-auto border-2 border-zinc-100 rounded-2xl mb-4 p-2 space-y-2">
                                        {dishes.map(dish => (
                                            <div key={dish.id} onClick={() => toggleExportSelection(dish.id)} className={`p-3 rounded-xl border flex justify-between items-center cursor-pointer ${exportSelection.has(dish.id) ? 'bg-blue-50 border-blue-200' : 'bg-white border-zinc-100'}`}>
                                                <span className="text-sm font-bold">{dish.name}</span>
                                                <div className={`w-5 h-5 rounded-md border flex items-center justify-center ${exportSelection.has(dish.id) ? 'bg-blue-500 border-blue-500' : 'border-zinc-300'}`}>
                                                    {exportSelection.has(dish.id) && <Icon name="Check" className="w-3 h-3 text-white" />}
                                                </div>
                                            </div>
                                        ))}
                                    </div>

                                    <button onClick={handleExport} className="w-full bg-zinc-900 text-white py-4 rounded-2xl font-bold flex justify-center gap-2 active:scale-95 transition-all">
                                        <Icon name="Download" className="w-5 h-5" /> Download File
                                    </button>
                                </section>

                                {/* Import Section */}
                                <section className="bg-zinc-100 p-6 rounded-[2rem] border-2 border-dashed border-zinc-300">
                                    <h3 className="font-black text-xl mb-2 flex items-center gap-2"><Icon name="Upload" className="w-5 h-5 text-green-600" /> Import Dishes</h3>
                                    <p className="text-sm text-zinc-500 mb-4">Upload a .json file to add new dishes.</p>
                                    
                                    <input type="file" accept=".json" ref={fileInputRef} className="hide-file-input" onChange={handleFileChange} />
                                    
                                    <button onClick={handleImportClick} className="w-full bg-white border-2 border-zinc-200 text-zinc-900 py-4 rounded-2xl font-bold flex justify-center gap-2 active:scale-95 transition-all hover:bg-zinc-50">
                                        <Icon name="Plus" className="w-5 h-5" /> Select File to Import
                                    </button>
                                </section>
                            </div>
                        )}
                    </main>

                    {/* Footer Floating Bar */}
                    {selectedIds.length > 0 && view !== 'meal' && view !== 'share' && (
                        <div className="fixed bottom-8 left-0 right-0 px-6 z-50">
                            <div className="max-w-md mx-auto bg-white/80 backdrop-blur-2xl rounded-[2.5rem] p-4 flex items-center justify-between shadow-2xl border border-white">
                                <div className="flex items-center gap-5 pl-4">
                                    <div className="bg-orange-500 w-12 h-12 rounded-2xl flex items-center justify-center font-black text-white text-xl shadow-lg">{selectedIds.length}</div>
                                    <div className="flex flex-col leading-none"><span className="text-[10px] font-black text-zinc-400 uppercase tracking-widest mb-1 text-zinc-500">Picked</span><span className="font-black text-zinc-900">ÈÅìËèúÂºè</span></div>
                                </div>
                                <button onClick={() => setView('meal')} className="bg-zinc-900 text-white px-10 py-4 rounded-[1.8rem] font-black flex items-center gap-3 active:scale-95 transition-all">ÂéªË≤∑È§∏ <Icon name="ChevronRight" className="w-5 h-5" /></button>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>